# 3D Mirror Surface Reconstruction – Simulation & Normal Estimation Pipeline

This repository contains a complete pipeline for simulating reflective surfaces,
generating distorted-glass geometry, reconstructing surface normals from reflection
patterns, and quantitatively evaluating reconstruction accuracy.  
All simulations are performed using **Mitsuba 3**, and all processing scripts are written in **Python**.

---

##  Project Structure Overview
file/
│
├── single_object_lamp.py              # Mitsuba-based simulation of a single object
├── create_distort_glass.py            # Distorted mirror (glass) geometry generation
├── reconstruct_normals_from_reflection.py   # Traditional normal estimation from reflection cues
└── compare_normals.py                 # Quantitative comparison between estimated and GT normals

---

## 1. `single_object_lamp.py`  
**Purpose:**  
Simulates a simple scene containing a single reflective object using **Mitsuba 3**.  
The output reflection images are used for downstream analysis, such as studying how 
reflected lines deform under different mirror geometries.

**Functions include:**  
- Setting up a controlled Mitsuba scene  
- Rendering a sequence of reflection frames  
- Saving the results for further processing

---

## 2. `create_distort_glass.py`  
**Purpose:**  
Generates a **distorted mirror (glass surface)** with controllable deformation patterns.  
This file defines the ground-truth height field and surface geometry used later for evaluating
normal estimation algorithms.

**Key features:**  
- Multi-frequency sinusoidal surface deformation  
- Optional localized “bump” distortions  
- Normalized displacement and laplacian smoothing  
- Export of final mesh compatible with Mitsuba rendering

This ground-truth geometry is the **reference normal field** used in evaluation.

---

## 3. `reconstruct_normals_from_reflection.py`  
**Purpose:**  
Implements a **traditional reflection-based method** to recover surface normals directly
from the simulated reflection images.

This algorithm:  
- Uses pixel-wise reflected-line displacement to infer orientation  
- Builds a height-field gradient approximation  
- Produces a reconstructed normal map for comparison

This represents a **baseline**, showing the difficulty of reconstructing normals from nonlinear
distorted reflections in complex scenes.

---

## 4. `compare_normals.py`  
**Purpose:**  
Quantitatively compares the **estimated normals** (from reconstruction) with the **ground-truth normals** generated by `create_distort_glass.py`.

It performs:  
- Reconstruction of the GT height field  
- Analytical normal computation  
- Interpolation to match reconstruction resolution  
- Angular error computation (mean, median, max)  
- Heatmap visualization of per-pixel error  
- Best axis and sign alignment using permutation search

This script provides the **final accuracy report** of the entire pipeline.

---

## Full Pipeline Summary

1. **Simulate Reflection Data**  
   → `single_object_lamp.py`

2. **Generate Distorted Mirror Geometry**  
   → `create_distort_glass.py`

3. **Reconstruct Normals from Reflection Patterns**  
   → `reconstruct_normals_from_reflection.py`

4. **Evaluate Reconstruction Accuracy**  
   → `compare_normals.py`

---

## Notes

- Mitsuba 3 must be installed and configured properly.  
- The reconstruction resolution (512×512) must match between scripts for correct evaluation.  
- For reproducibility, all geometry parameters in the scripts should remain synchronized.

---

## Experiment Outputs

All reconstructed normal maps, evaluation heatmaps, intermediate visualization results, and quantitative error reports generated by the pipeline are stored in the `recon_out/` directory.

---

##  Contact  
If you have questions, feel free to open an issue or reach out.